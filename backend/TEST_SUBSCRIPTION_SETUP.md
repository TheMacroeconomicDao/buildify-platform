# Тестовые подписки за $0

## Обзор

Реализована система тестовых подписок за $0 для проверки функционала подписок без интеграции со Stripe.

## Особенности тестовых подписок

- **Цена**: Всегда $0.00
- **Stripe интеграция**: Отсутствует (stripe_product_id и stripe_price_id = null)
- **Активация**: Мгновенная, без платежных форм
- **Функционал**: Полный доступ к возможностям согласно лимитам тарифа
- **Отличие от Free**: Можно "купить" и активировать, имеет срок действия

## Созданные тестовые подписки

1. **Test** - базовая тестовая подписка (30 дней, 10 заказов, 20 контактов)
2. **Premium Test** - расширенная тестовая подписка (7 дней, 5 заказов, 15 контактов)

## Управление через админ-панель

### Создание тестовой подписки

1. Перейти в админ-панель → Подписки → Создать
2. Заполнить обычные поля (название, длительность, лимиты)
3. Установить флаг "Test subscription ($0 - no Stripe integration)"
4. Сохранить

**Важно**: При установке флага "Test subscription":
- Цена автоматически устанавливается в $0.00
- Stripe ID обнуляются
- Подписка становится доступной для мгновенной активации

### Редактирование тестовой подписки

Аналогично созданию - можно изменить любые параметры и переключить режим тестирования.

## Использование через API

### Получение списка подписок

```http
GET /api/subscriptions
```

Тестовые подписки отображаются наравне с обычными, но имеют:
- `price: 0.00`
- `is_test: true`
- `stripe_product_id: null`
- `stripe_price_id: null`

### Активация тестовой подписки

```http
POST /api/subscriptions/{tariff_id}/checkout
```

Для тестовых подписок:
- Не создается Stripe Checkout Session
- Подписка активируется мгновенно
- Возвращается `is_test: true` в ответе

**Пример ответа:**
```json
{
    "success": true,
    "message": "Тестовая подписка успешно активирована",
    "tariff": {...},
    "is_free": true,
    "is_test": true
}
```

## Команды Artisan

### Создание тестовой подписки

```bash
php artisan subscription:create-test [options]
```

**Опции:**
- `--name=Test` - название подписки
- `--price=0` - цена (всегда 0 для тестовых)
- `--days=30` - длительность в днях
- `--orders=10` - максимум заказов
- `--contacts=20` - максимум контактов

**Примеры:**
```bash
# Создать базовую тестовую подписку
php artisan subscription:create-test

# Создать кастомную тестовую подписку
php artisan subscription:create-test --name="Weekly Test" --days=7 --orders=3 --contacts=10
```

### Создание через сидер

```bash
php artisan db:seed --class=TestTariffSeeder
```

## База данных

### Новое поле в таблице tariffs

```sql
ALTER TABLE tariffs ADD COLUMN is_test BOOLEAN DEFAULT FALSE COMMENT 'Тестовая подписка для проверки функционала';
```

### Модель Tariff

Добавлено поле `is_test` в `$fillable`.

## Логика работы

1. **При создании/редактировании** тестовой подписки:
   - Цена принудительно устанавливается в 0.00
   - Stripe ID обнуляются
   - Продукты в Stripe не создаются

2. **При активации** тестовой подписки:
   - Пропускается создание Stripe Checkout Session
   - Подписка активируется мгновенно через `User::activateSubscription()`
   - Устанавливаются даты начала и окончания согласно длительности

3. **Проверка активности** работает стандартно:
   - Проверяется дата окончания подписки
   - Применяются лимиты согласно тарифу

## Отличия от Free тарифа

| Параметр | Free тариф | Тестовая подписка |
|----------|------------|-------------------|
| Цена | $0.00 | $0.00 |
| Можно "купить" | Нет | Да |
| Срок действия | Бессрочно | Ограничен |
| Лимиты | Минимальные/нулевые | Настраиваемые |
| Назначение | Базовый доступ | Тестирование функций |

## Использование для тестирования

Тестовые подписки идеально подходят для:

1. **Проверки функционала подписок** без реальных платежей
2. **Тестирования лимитов** (заказы, контакты)
3. **Проверки истечения подписок** (короткие периоды)
4. **Демонстрации возможностей** потенциальным клиентам
5. **QA тестирования** всего flow подписок

## Безопасность

- Тестовые подписки не влияют на финансовые операции
- Не создают записи в Stripe
- Легко идентифицируются по флагу `is_test`
- Можно легко удалить или деактивировать
